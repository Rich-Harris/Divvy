(function(t){"use strict";var e=function(){var t,i,s,n,o,r,h,d,c,a,l,u,m;return m=function(){var t,e,i;return t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),i=Math.floor(256*Math.random()),"rgb("+[t,e,i].join(",")+")"},s="row",n="column",o="left",r="top",h="width",d="height",c="vertical",a="horizontal",l="clientX",u="clientY",t=function(e,l,u,v,p,f,y){var w,z,P,x,g,E,b;if(this.start=p,this.size=f,this.end=this.start+this.size,this.type=y,this.parent=l,this.min=v.min||e.min,this.max=v.max,this.node=document.createElement("div"),this.node.className="divvy-block",this.node.style[y===n?o:r]=p+"%",this.node.style[y===n?h:d]=f+"%","string"==typeof v&&(v={id:v}),"[object Array]"===Object.prototype.toString.call(v)&&(v={children:v}),v.id&&(this.node.id=v.id,v.children||(e.blocks[v.id]=this.node)),v.children||(this.node.style.backgroundColor=m()),v.children){for(w=v.children.reduce(function(t,e){return t+(e.size||1)},0),this.children=[],this.controls=[],P=0,z=0;v.children.length>z;z+=1)x=v.children[z],g=100*((x.size||1)/w),this.children[z]=new t(e,this,this.node,x,P,g,y===n?s:n),P+=g;for(z=0;v.children.length-1>z;z+=1)E=this.children[z],b=this.children[z+1],this.controls[z]=new i(e,this,this.node,E,b,y===s?c:a)}u.appendChild(this.node)},t.prototype={setStart:function(t){var e,i,s,c;e=this.start,i=this.size,s=t-e,c=i-s,this.node.style[this.type===n?o:r]=t+"%",this.node.style[this.type===n?h:d]=c+"%",this.start=t,this.size=c},setEnd:function(t){var e,i,s,o;e=this.end,i=this.size,s=t-e,o=i+s,this.node.style[this.type===n?h:d]=o+"%",this.end=t,this.size=o},shake:function(){var t,e,i,s,o,r;if(this.children){for(this.bcr=this.node.getBoundingClientRect(),this.pixelSize=this.bcr[this.type===n?d:h],e=this.children.length,t=0;e-1>t;t+=1)i=this.children[t],s=this.children[t+1],o=this.controls[t],r=i.minPc(),r>i.size&&(i.setEnd(i.start+r),s.setStart(i.start+r),o.setPosition(i.start+r)),r=i.maxPc(),i.size>r&&(i.setEnd(i.start+r),s.setStart(i.start+r),o.setPosition(i.start+r));for(t=e-1;t>0;t-=1)i=this.children[t-1],s=this.children[t],o=this.controls[t-1],r=s.minPc(),r>s.size&&(i.setEnd(s.end-r),s.setStart(s.end-r),o.setPosition(s.end-r)),r=s.maxPc(),s.size>r&&(i.setEnd(s.end-r),s.setStart(s.end-r),o.setPosition(s.end-r));for(t=this.children.length;t--;)this.children[t].shake()}},minPc:function(){var t;return t=this.parent.pixelSize,100*(this.min/t)},maxPc:function(){var t;return this.max?(t=this.parent.pixelSize,100*(this.max/t)):100}},i=function(t,e,i,s,n,o){var r=this;this.root=t,this.parent=e,this.before=s,this.after=n,this.type=o,this.parentNode=i,this.node=document.createElement("div"),this.node.className="divvy-"+o+"-control",this.setPosition(n.start),this.node.addEventListener("mousedown",function(t){var e,i,h,d,a;r.setActive(),t.preventDefault(),e=Math.max(s.start+s.minPc(),n.end-n.maxPc()),i=Math.min(s.start+s.maxPc(),n.end-n.minPc()),h=function(t){var h;h=r.getPosition(t[o===c?l:u]),h=Math.max(e,Math.min(i,h)),s.setEnd(h),n.setStart(h),r.setPosition(h)},d=function(){r.setInactive(),a()},a=function(){window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",d)},window.addEventListener("mousemove",h),window.addEventListener("mouseup",d)}),i.appendChild(this.node)},i.prototype={setActive:function(){this.node.classList.add("active"),this.root.cursor(this.type===c?"ew":"ns")},setInactive:function(){this.node.classList.remove("active"),this.root.cursor(!1)},getPosition:function(t){var e,i,s,n;return e=this.parent.bcr,i=e[this.type===c?o:r],s=e[this.type===c?h:d],n=100*(t-i)/s},setPosition:function(t){this.node.style[this.type===c?o:r]=t+"%"}},e=function(e){var i,o,r=this;if(this.el=e.el,i=document.createDocumentFragment(),e.columns&&e.rows)throw Error("You can't have top level rows and top level columns - one or the other");e.columns?(this.type=s,o=e.columns):e.rows&&(this.type=n,o=e.rows),this.blocks={},this.min=e.min||10,this.root=new t(this,this,i,{children:o},0,100,this.type),this.el.appendChild(i),e.shakeOnResize!==!1&&window.addEventListener("resize",function(){r.shake()}),this.shake()},e.prototype={shake:function(){this.bcr=this.el.getBoundingClientRect(),this.pixelSize=this.bcr[this.type===n?d:h],this.root.shake()},cursor:function(t){return t?(this._cursor=this.el.style.cursor,this.el.style.cursor=t+"-resize",void 0):(this.el.style.cursor=this._cursor,void 0)}},e}();t.module!==void 0&&t.module.exports?t.module.exports=e:t.define!==void 0&&t.define.amd?t.define(function(){return e}):t.Divvy=e})(this);