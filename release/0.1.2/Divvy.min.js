(function(t){"use strict";var i=function(){var t,e,s,n,h,o,r,d,c,a,l,u,v,f,m;return o="row",r="column",d="left",c="top",a="width",l="height",u="vertical",v="horizontal",f="clientX",m="clientY",s=function(t,i){var e,s;for(e=0,s=i.length;s>e;e+=1)if(i[e]===t)return t;return-1},n=function(t,i){var e;t.classList&&t.classList.add?n=function(t,i){t.classList.add(i)}:(e=function(t){return t.replace(/^\s*/,"").replace(/\s*$/)},n=function(t,i){var n,h;n=t.className.split(" ").map(e),h=n.indexOf?n.indexOf(i):s(i,n),-1===h&&(t.className=n.concat(i).join(" "))}),n(t,i)},h=function(t,i){var e;t.classList&&t.classList.remove?h=function(t,i){t.classList.remove(i)}:(e=function(t){return t.replace(/^\s*/,"").replace(/\s*$/)},h=function(t,i){var n,h;n=t.className.split(" ").map(e),h=n.indexOf?n.indexOf(i):s(i,n),-1!==h&&(n.splice(h,1),t.className=n.join(" "))}),h(t,i)},t=function(i,s,h,f,m,p,g,y,b){var w,z,x,E,P,L,S,k,_;if(this.start=p,this.size=g,this.end=this.start+this.size,this.type=y,this.root=i,this.parent=s,this.edges=b,this.min=m.min||i.min,this.max=m.max,m instanceof Element&&(m={node:m}),"string"==typeof m&&(m={id:m}),"[object Array]"===Object.prototype.toString.call(m)&&(m={children:m}),this.id=m.id||f,m.children&&m.children.length?(this.node=document.createElement("div"),n(this.node,"divvy-block"),n(this.node,"divvy-branch"),this.node.id=this.id):(this.node=document.createElement("div"),n(this.node,"divvy-block"),n(this.node,"divvy-leaf"),!m.node&&m.id&&(L=document.getElementById(m.id))&&(m.node=L),this.inner=m.node?m.node:document.createElement("div"),n(this.inner,"divvy-inner"),this.node.appendChild(this.inner),i.blocks[this.id]=this.inner,this.inner.id=this.id),b.top&&n(this.node,"divvy-top"),b.right&&n(this.node,"divvy-right"),b.bottom&&n(this.node,"divvy-bottom"),b.left&&n(this.node,"divvy-left"),this.node.style[y===r?d:c]=p+"%",this.node.style[y===r?a:l]=g+"%",m.children){for(w=m.children.reduce(function(t,i){return t+(i.size||1)},0),this.children=[],this.controls=[],x=0,z=0;m.children.length>z;z+=1)E=m.children[z],P=100*((E.size||1)/w),_={},y===r?(_.top=b.top&&0===z,_.bottom=b.bottom&&z===m.children.length-1,_.left=b.left,_.right=b.right):(_.left=b.left&&0===z,_.right=b.right&&z===m.children.length-1,_.top=b.top,_.bottom=b.bottom),this.children[z]=new t(i,this,this.node,f+z,E,x,P,y===r?o:r,_),x+=P;for(z=0;m.children.length-1>z;z+=1)S=this.children[z],k=this.children[z+1],this.controls[z]=new e(i,this,this.node,S,k,y===o?u:v)}h.appendChild(this.node)},t.prototype={setStart:function(t){var i,e,s,n;i=this.start,e=this.size,s=t-i,n=e-s,this.node.style[this.type===r?d:c]=t+"%",this.node.style[this.type===r?a:l]=n+"%",this.start=t,this.size=n,this.shake()},setEnd:function(t){var i,e,s,n;i=this.end,e=this.size,s=t-i,n=e+s,this.node.style[this.type===r?a:l]=n+"%",this.end=t,this.size=n,this.shake()},shake:function(){var t,i,e,s,n,h;if(this.bcr=this.node.getBoundingClientRect(),(this.bcr.width!==this.width||this.bcr.height!==this.height)&&(this.width=this.bcr.width,this.height=this.bcr.height,this.root._changed[this.id]=this.root._changedSinceLastResize[this.id]=!0,this.children)){for(this.pixelSize=this.bcr[this.type===r?l:a],i=this.children.length,t=0;i-1>t;t+=1)e=this.children[t],s=this.children[t+1],n=this.controls[t],h=e.minPc(),h>e.size&&(e.setEnd(e.start+h),s.setStart(e.start+h),n.setPosition(e.start+h)),h=e.maxPc(),e.size>h&&(e.setEnd(e.start+h),s.setStart(e.start+h),n.setPosition(e.start+h));for(t=i-1;t>0;t-=1)e=this.children[t-1],s=this.children[t],n=this.controls[t-1],h=s.minPc(),h>s.size&&(e.setEnd(s.end-h),s.setStart(s.end-h),n.setPosition(s.end-h)),h=s.maxPc(),s.size>h&&(e.setEnd(s.end-h),s.setStart(s.end-h),n.setPosition(s.end-h));for(t=this.children.length;t--;)this.children[t].shake()}},minPc:function(){var t;return t=this.parent.pixelSize,100*(this.min/t)},maxPc:function(){var t;return this.max?(t=this.parent.pixelSize,100*(this.max/t)):100}},e=function(t,i,e,s,h,o){var r=this;this.root=t,this.parent=i,this.before=s,this.after=h,this.type=o,this.parentNode=e,this.node=document.createElement("div"),n(this.node,"divvy-"+o+"-control"),this.setPosition(h.start),this.node.addEventListener("mousedown",function(t){var i,e,n,d,c;r.setActive(),t.preventDefault(),i=Math.max(s.start+s.minPc(),h.end-h.maxPc()),e=Math.min(s.start+s.maxPc(),h.end-h.minPc()),n=function(t){var n;n=r.getPosition(t[o===u?f:m]),n=Math.max(i,Math.min(e,n)),s.setEnd(n),h.setStart(n),r.setPosition(n),r.root.fire("resize",r.root._changedSinceLastResize),r.root._changedSinceLastResize={}},d=function(){r.setInactive(),c()},c=function(){window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",d)},window.addEventListener("mousemove",n),window.addEventListener("mouseup",d)}),e.appendChild(this.node)},e.prototype={setActive:function(){n(this.node,"divvy-active"),this.root.cursor(this.type===u?"ew":"ns")},setInactive:function(){h(this.node,"divvy-active"),this.root.cursor(!1)},getPosition:function(t){var i,e,s,n;return i=this.parent.bcr,e=i[this.type===u?d:c],s=i[this.type===u?a:l],n=100*(t-e)/s},setPosition:function(t){this.node.style[this.type===u?d:c]=t+"%"}},i=function(i){var e,s,n=this;if(this.el=i.el,e=document.createDocumentFragment(),i.columns&&i.rows)throw Error("You can't have top level rows and top level columns - one or the other");i.columns?(this.type=o,s=i.columns):i.rows&&(this.type=r,s=i.rows),this.blocks={},this.subs={},this.min=i.min||10,this.root=new t(this,this,e,"divvy-0",{children:s},0,100,this.type,{top:!0,right:!0,bottom:!0,left:!0}),this.el.appendChild(e),i.shakeOnResize!==!1&&window.addEventListener("resize",function(){n._changedSinceLastResize={},n.shake(),n.fire("resize",n._changedSinceLastResize)}),this._changed={},this._changedSinceLastResize={},this.shake()},i.prototype={shake:function(){this.bcr=this.el.getBoundingClientRect(),(this.bcr.width!==this.width||this.bcr.height!==this.height)&&(this.width=this.bcr.width,this.height=this.bcr.height,this.pixelSize=this[this.type===r?l:a],this.root.shake())},cursor:function(t){return t?(this._cursor=this.el.style.cursor,this.el.style.cursor=t+"-resize",void 0):(this.el.style.cursor=this._cursor,void 0)},changed:function(){var t=this._changed;return this._changed={},t},on:function(t,i){var e;(e=this.subs[t])?e[e.length]=i:this.subs[t]=[i]},off:function(t,i){var e,s;return t?i?(s=this.subs[t])?(e=s.indexOf(i),-1!==e&&(s.splice(e,1),s.length||delete this.subs[t]),void 0):this:(delete this.subs[t],this):(this.subs={},this)},fire:function(t){var i,e,s,n;if(e=this.subs[t],!e)return this;if(i=Array.prototype.slice.call(arguments,1),!i.length){for(s=0,n=e.length;n>s;s+=1)e[s].call(this);return this}for(s=0,n=e.length;n>s;s+=1)e[s].apply(this,i);return this}},i}();t.module!==void 0&&t.module.exports?t.module.exports=i:t.define!==void 0&&t.define.amd?t.define(function(){return i}):t.Divvy=i})(this);