(function(t){"use strict";var i;(function(){var t,e,s,n,h,o,r,d,c,a="row",l="column",u="left",v="top",f="width",m="height",p="vertical",g="horizontal",y="clientX",b="clientY";i=function(i){var e,s,n=this;if(this.el=i.el,e=document.createDocumentFragment(),i.columns&&i.rows)throw Error("You can't have top level rows and top level columns - one or the other");i.columns?(this.type=a,s=i.columns):i.rows&&(this.type=l,s=i.rows),this.blocks={},this.subs={},this.min=i.min||10,this.root=new t(this,this,e,"divvy-0",{children:s},0,100,this.type,{top:!0,right:!0,bottom:!0,left:!0}),this.el.appendChild(e),i.shakeOnResize!==!1&&window.addEventListener("resize",function(){n._changedSinceLastResize={},n.shake(),c(n,"resize",n._changedSinceLastResize)}),this._changed={},this._changedSinceLastResize={},this.shake()},i.prototype={shake:function(){return this.bcr=this.el.getBoundingClientRect(),this.bcr.width!==this.width||this.bcr.height!==this.height?(this.width=this.bcr.width,this.height=this.bcr.height,this.pixelSize=this[this.type===l?m:f],this.root.shake(),this):void 0},changed:function(){var t=this._changed;return this._changed={},t},getState:function(){var t={};return o(this.root,t),t},setState:function(t){var i,e={};r(this,this.root,t,e);for(i in e)if(e.hasOwnProperty(i)){c(this,"resize",e);break}return this},save:function(t){var i,e;if(localStorage)return i=t?"divvy_"+t:"divvy",e=JSON.stringify(this.getState()),localStorage.setItem(i,e),this},restore:function(t){var i,e;if(localStorage)return i=t?"divvy_"+t:"divvy",e=JSON.parse(localStorage.getItem(i)),e&&this.setState(e),this},on:function(t,i){var e,s=this;return(e=this.subs[t])?e[e.length]=i:this.subs[t]=[i],{cancel:function(){s.off(t,i)}}},off:function(t,i){var e,s;return t?i?(s=this.subs[t])?(e=s.indexOf(i),-1!==e&&(s.splice(e,1),s.length||delete this.subs[t]),this):this:(delete this.subs[t],this):(this.subs={},this)}},c=function(t,i){var e,s,n,h;if(s=t.subs[i]){if(e=Array.prototype.slice.call(arguments,2),e.length){for(n=0,h=s.length;h>n;n+=1)s[n].apply(t,e);return t}for(n=0,h=s.length;h>n;n+=1)s[n].call(t)}},o=function(t,i){var e;if(i[t.id]=[t.start,t.size],t.children)for(e=t.children.length;e--;)o(t.children[e],i)},r=function(t,i,e,s,n){var h,o,d,c,a;if(a=e[i.id]){if((i.start!==a[0]||i.size!==a[1])&&(t._changed[i.id]=s[i.id]=!0),i.start=a[0],i.size=a[1],i.end=i.start+i.size,i.node.style[i.type===l?u:v]=i.start+"%",i.node.style[i.type===l?f:m]=i.size+"%",i.children){for(c=0,o=i.children.length,h=0;o>h;h+=1)d=i.children[h],r(t,d,e,s,!0),c+=d.size,i.controls[h]&&i.controls[h].setPosition(c);for(h=i.children.length;h--;)r(t,i.children[h],e,s,!0)}n||i.shake()}},d=function(t,i){return i?(t._cursor=t.el.style.cursor,t.el.style.cursor=i+"-resize",void 0):(t.el.style.cursor=t._cursor,void 0)},t=function(i,s,h,o,r,d,c,y,b){var z,w,S,x,P,E,L,k,_;if(this.start=d,this.size=c,this.end=this.start+this.size,this.type=y,this.root=i,this.parent=s,this.edges=b,this.min=r.min||i.min,this.max=r.max,r instanceof Element&&(r={node:r}),"string"==typeof r&&(r={id:r}),"[object Array]"===Object.prototype.toString.call(r)&&(r={children:r}),this.id=r.id||o,r.children&&r.children.length?(this.node=document.createElement("div"),n(this.node,"divvy-block"),n(this.node,"divvy-branch"),this.node.id=this.id):(this.node=document.createElement("div"),n(this.node,"divvy-block"),n(this.node,"divvy-leaf"),!r.node&&r.id&&(E=document.getElementById(r.id))&&(r.node=E),this.inner=r.node?r.node:document.createElement("div"),n(this.inner,"divvy-inner"),this.node.appendChild(this.inner),i.blocks[this.id]=this.inner,this.inner.id=this.id),b.top&&n(this.node,"divvy-top"),b.right&&n(this.node,"divvy-right"),b.bottom&&n(this.node,"divvy-bottom"),b.left&&n(this.node,"divvy-left"),this.node.style[y===l?u:v]=d+"%",this.node.style[y===l?f:m]=c+"%",r.children){for(z=r.children.reduce(function(t,i){return t+(i.size||1)},0),this.children=[],this.controls=[],S=0,w=0;r.children.length>w;w+=1)x=r.children[w],P=100*((x.size||1)/z),_={},y===l?(_.top=b.top&&0===w,_.bottom=b.bottom&&w===r.children.length-1,_.left=b.left,_.right=b.right):(_.left=b.left&&0===w,_.right=b.right&&w===r.children.length-1,_.top=b.top,_.bottom=b.bottom),this.children[w]=new t(i,this,this.node,o+w,x,S,P,y===l?a:l,_),S+=P;for(w=0;r.children.length-1>w;w+=1)L=this.children[w],k=this.children[w+1],this.controls[w]=new e(i,this,this.node,L,k,y===a?p:g)}h.appendChild(this.node)},t.prototype={setStart:function(t){var i,e,s,n;i=this.start,e=this.size,s=t-i,n=e-s,this.node.style[this.type===l?u:v]=t+"%",this.node.style[this.type===l?f:m]=n+"%",this.start=t,this.size=n,this.shake()},setEnd:function(t){var i,e,s,n;i=this.end,e=this.size,s=t-i,n=e+s,this.node.style[this.type===l?f:m]=n+"%",this.end=t,this.size=n,this.shake()},shake:function(){var t,i,e,s,n,h;if(this.bcr=this.node.getBoundingClientRect(),(this.bcr.width!==this.width||this.bcr.height!==this.height)&&(this.width=this.bcr.width,this.height=this.bcr.height,this.root._changed[this.id]=this.root._changedSinceLastResize[this.id]=!0,this.children)){for(this.pixelSize=this.bcr[this.type===l?m:f],i=this.children.length,t=0;i-1>t;t+=1)e=this.children[t],s=this.children[t+1],n=this.controls[t],h=e.minPc(),h>e.size&&(e.setEnd(e.start+h),s.setStart(e.start+h),n.setPosition(e.start+h)),h=e.maxPc(),e.size>h&&(e.setEnd(e.start+h),s.setStart(e.start+h),n.setPosition(e.start+h));for(t=i-1;t>0;t-=1)e=this.children[t-1],s=this.children[t],n=this.controls[t-1],h=s.minPc(),h>s.size&&(e.setEnd(s.end-h),s.setStart(s.end-h),n.setPosition(s.end-h)),h=s.maxPc(),s.size>h&&(e.setEnd(s.end-h),s.setStart(s.end-h),n.setPosition(s.end-h));for(t=this.children.length;t--;)this.children[t].shake()}},minPc:function(){var t;return t=this.parent.pixelSize,100*(this.min/t)},maxPc:function(){var t;return this.max?(t=this.parent.pixelSize,100*(this.max/t)):100}},e=function(t,i,e,s,h,o){var r=this;this.root=t,this.parent=i,this.before=s,this.after=h,this.type=o,this.parentNode=e,this.node=document.createElement("div"),n(this.node,"divvy-"+o+"-control"),this.setPosition(h.start),this.node.addEventListener("mousedown",function(t){var i,e,n,d,a;r.setActive(),t.preventDefault(),i=Math.max(s.start+s.minPc(),h.end-h.maxPc()),e=Math.min(s.start+s.maxPc(),h.end-h.minPc()),n=function(t){var n;n=r.getPosition(t[o===p?y:b]),n=Math.max(i,Math.min(e,n)),s.setEnd(n),h.setStart(n),r.setPosition(n),c(r.root,"resize",r.root._changedSinceLastResize),r.root._changedSinceLastResize={}},d=function(){r.setInactive(),a()},a=function(){window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",d)},window.addEventListener("mousemove",n),window.addEventListener("mouseup",d)}),e.appendChild(this.node)},e.prototype={setActive:function(){n(this.node,"divvy-active"),d(this.root,this.type===p?"ew":"ns")},setInactive:function(){h(this.node,"divvy-active"),d(this.root,!1)},getPosition:function(t){var i,e,s,n;return i=this.parent.bcr,e=i[this.type===p?u:v],s=i[this.type===p?f:m],n=100*(t-e)/s},setPosition:function(t){this.node.style[this.type===p?u:v]=t+"%"}},s=function(t,i){var e,s;for(e=0,s=i.length;s>e;e+=1)if(i[e]===t)return t;return-1},n=function(t,i){var e;t.classList&&t.classList.add?n=function(t,i){t.classList.add(i)}:(e=function(t){return t.replace(/^\s*/,"").replace(/\s*$/)},n=function(t,i){var n,h;n=t.className.split(" ").map(e),h=n.indexOf?n.indexOf(i):s(i,n),-1===h&&(t.className=n.concat(i).join(" "))}),n(t,i)},h=function(t,i){var e;t.classList&&t.classList.remove?h=function(t,i){t.classList.remove(i)}:(e=function(t){return t.replace(/^\s*/,"").replace(/\s*$/)},h=function(t,i){var n,h;n=t.className.split(" ").map(e),h=n.indexOf?n.indexOf(i):s(i,n),-1!==h&&(n.splice(h,1),t.className=n.join(" "))}),h(t,i)}})(),t.module!==void 0&&t.module.exports?t.module.exports=i:t.define!==void 0&&t.define.amd?t.define(function(){return i}):t.Divvy=i})(this);